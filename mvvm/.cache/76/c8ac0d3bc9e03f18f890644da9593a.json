{"id":"index.html","dependencies":[{"name":"/Users/erzong/projects/MyTest/package.json","includedInParent":true,"mtime":1558357503899}],"generated":{"html":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n\n<body>\n    <div id=\"app\">\n        <h3>姓名</h3>\n        <p>{{name}}</p>\n        <h3>年龄</h3>\n        <p>{{age}}</p>\n        <h4>性别</h4>\n        <p>{{gender}}</p>\n        <p>fdsfsd: \n            <span><span>{{age}}</span><span>{{age}}</span></span>\n            <span>{{age}}</span>\n            <span>{{age}}</span>\n        </p>\n        <button id=\"b\">change</button>\n    </div>\n</body>\n\n</html>\n<script>function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  var opt = {\n    el: '#app',\n    data: {\n      name: '检索中...',\n      age: 30,\n      gender: 'man'\n    }\n  };\n  var vm = new Vue(opt);\n  setTimeout(function () {\n    opt.data.name = '王永峰';\n  }, 2000);\n  b.addEventListener('click', function () {\n    opt.data.name = Math.random();\n  });\n}, false);\n\nvar Vue =\n/*#__PURE__*/\nfunction () {\n  function Vue(opt) {\n    _classCallCheck(this, Vue);\n\n    this.opt = opt;\n    this.observe(opt.data); // 观察数据\n\n    var root = document.querySelector(opt.el);\n    this.compile(root); // 编译页面\n  } // 为响应式对象 data 里的每一个 key 绑定一个观察者对象\n\n\n  _createClass(Vue, [{\n    key: \"observe\",\n    value: function observe(data) {\n      Object.keys(data).forEach(function (key) {\n        var obv = new Observer();\n        data[\"_\" + key] = data[key]; // 通过 getter setter 暴露 for 循环中作用域下的 obv，闭包产生\n\n        Object.defineProperty(data, key, {\n          get: function get() {\n            Observer.target && obv.addSubNode(Observer.target);\n            return data['_' + key];\n          },\n          set: function set(newVal) {\n            obv.update(newVal);\n            data['_' + key] = newVal;\n          }\n        });\n      });\n    } // 初始化页面，遍历 DOM，收集每一个key变化时，随之调整的位置，以观察者方法存放起来    \n\n  }, {\n    key: \"compile\",\n    value: function compile(node) {\n      var _this = this;\n\n      [].forEach.call(node.childNodes, function (child) {\n        console.log('child: ', child);\n\n        if (!child.firstElementChild && /\\{\\{(.*)\\}\\}/.test(child.innerHTML)) {\n          var key = RegExp.$1.trim();\n          child.innerHTML = child.innerHTML.replace(new RegExp('\\\\{\\\\{\\\\s*' + key + '\\\\s*\\\\}\\\\}', 'gm'), _this.opt.data[key]);\n          Observer.target = child;\n          _this.opt.data[key];\n          Observer.target = null;\n\n          if (child.childElementCount) {\n            _this.compile(child);\n          }\n        } else if (child.childElementCount) {\n          _this.compile(child);\n        }\n      });\n    }\n  }]);\n\n  return Vue;\n}(); // 常规观察者类\n\n\nvar Observer =\n/*#__PURE__*/\nfunction () {\n  function Observer() {\n    _classCallCheck(this, Observer);\n\n    this.subNode = [];\n  }\n\n  _createClass(Observer, [{\n    key: \"addSubNode\",\n    value: function addSubNode(node) {\n      this.subNode.push(node);\n    }\n  }, {\n    key: \"update\",\n    value: function update(newVal) {\n      this.subNode.forEach(function (node) {\n        node.innerHTML = newVal;\n      });\n    }\n  }]);\n\n  return Observer;\n}();</script>"},"sourceMaps":null,"error":null,"hash":"af0360726519b88609d97b35429bcd3c","cacheData":{"env":{}}}